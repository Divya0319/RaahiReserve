<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Passenger Details</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        /* Container for checkbox and label */
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px; /* Adjust the spacing below the checkbox */
        }

        /* Checkbox style */
        .checkbox-container input[type="checkbox"] {
            width: 24px;
            height: 24px;
            accent-color: green; /* Green tick color */
            margin-right: 10px; /* Space between checkbox and label */
        }

        /* Label style */
        .checkbox-container label {
            font-size: 18px; /* Adjust label font size */
            margin: 0; /* Ensure no margin is causing misalignment */
        }
    </style>
</head>
<body>
<div class="container mt-5 mb-5">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h2 class="mt-4">Passenger Details</h2>
        </div>
        <div class="card-body bg-light text-dark">
            <form th:action="@{/bookings/checkRouteAvailability}" method="post">

                <!-- User Selection Dropdown -->
                <div class="form-group mt-2">
                    <label for="user">Select User to Add as passenger:</label>
                    <select class="form-control" name="userId" id="user">
                        <option value="">No User Selected</option>
                        <option th:each="user : ${users}"
                                th:value="${user.userId}"
                                th:text="${user.userName}"
                                th:selected="${user.userId == selectedUserId}"></option>
                    </select>
                </div>

                <div class="checkbox-container">
                    <input type="checkbox" name="addUserAsPassenger" id="addUserAsPassenger">
                    <label for="addUserAsPassenger">Add user as passenger</label>
                </div>

                <!-- Source Selection Dropdown -->
                <div class="form-group mt-2">
                    <label for="source">Select Source:</label>
                    <select class="form-control" name="source" id="source">
                        <option value="">No Source Selected</option>
                        <option
                                th:each="source : ${sources}"
                                th:value="${source}"
                                th:text="${source}"
                                th:selected="${source == selectedSource}"></option>
                    </select>
                </div>

                <!-- Destination Selection Dropdown -->
                <div class="form-group mt-2">
                    <label for="destination">Select Destination:</label>
                    <select class="form-control" name="destination" id="destination">
                        <option value="">No Destination Selected</option>
                        <option
                                th:each="destination : ${destinations}"
                                th:value="${destination}"
                                th:text="${destination}"
                                th:selected="${destination == selectedDestination}"></option>
                    </select>
                </div>

                <!-- Check Availability Button -->
                <button type="submit" class="btn btn-warning mt-3">Check Availability</button>
            </form>

                <!-- Error message div -->
                <div class="alert alert-danger mt-3" th:if="${errorMessage != null}" >
                    <p th:text="${errorMessage}"></p>
                </div>

                <!-- Success message div -->
                <div class="alert alert-success mt-3" th:if="${successMessage != null}" >
                    <p th:text="${successMessage}"></p>
                </div>


                <!-- Passenger Forms -->
            <form th:action="@{/bookings/create}" method="post">
                <!-- Hidden Inputs -->
                <input type="hidden" name="userId" th:value="${selectedUserId}">
                <input type="hidden" name="source" th:value="${selectedSource}">
                <input type="hidden" name="destination" th:value="${selectedDestination}">

                <div id="passenger-forms">
                    <div class="form-group passenger-form mt-4">
                        <label for="name-0">Passenger Name:</label>
                        <input type="text" class="form-control" name="passengers[0].name" id="name-0" required>

                        <label for="age-0">Age:</label>
                        <input type="number" class="form-control" name="passengers[0].age" id="age-0" required>

                        <label for="gender-0">Gender:</label>
                        <select class="form-control" name="passengers[0].gender" id="gender-0">
                            <option th:each="gender : ${genders}" th:value="${gender}" th:text="${gender}">Gender</option>
                        </select>

                        <label for="seatPreference-0">Seat Preference:</label>
                        <select class="form-control" name="passengers[0].busSeat.seatType" id="seatPreference-0">
                            <option th:each="seatPref : ${seatPreferences}" th:value="${seatPref}" th:text="${seatPref}">Seat Preference</option>
                        </select>
                    </div>
                </div>

                <button type="button" id="add-passenger" class="btn btn-primary mt-3">Add Another Passenger</button>
                <button type="submit" class="btn btn-success mt-3">Submit</button>
            </form>
        </div>
    </div>
</div>

<script type="text/javascript">
    let passengerIndex = 1;

    // Pass Thymeleaf variables to JavaScript

    const genders = ['MALE', 'FEMALE', 'OTHER'];
    const seatPreferences = ['NO_PREFERENCE', 'AISLE', 'WINDOW'];

    $('#add-passenger').click(function () {
        const newForm = `
            <hr class="text-primary my-4" style="border-top: 3px solid; border-radius: 5px;">
            <div class="form-group passenger-form mt-4">
                <label for="name-${passengerIndex}">Passenger Name:</label>
                <input type="text" class="form-control" name="passengers[${passengerIndex}].name" id="name-${passengerIndex}" required>

                <label for="age-${passengerIndex}">Age:</label>
                <input type="number" class="form-control" name="passengers[${passengerIndex}].age" id="age-${passengerIndex}" required>

                <label for="gender-${passengerIndex}">Gender:</label>
                <select class="form-control" name="passengers[${passengerIndex}].gender" id="gender-${passengerIndex}">
                    ${genders.map(gender => `<option value="${gender}">${gender}</option>`).join('')}
                </select>

                <label for="seatPreference-${passengerIndex}">Seat Preference:</label>
                <select class="form-control" name="passengers[${passengerIndex}].busSeat.seatType" id="seatPreference-${passengerIndex}">
                    ${seatPreferences.map(seatPref => `<option value="${seatPref}">${seatPref}</option>`).join('')}
                </select>
            </div>
        `;

        $('#passenger-forms').append(newForm);
        passengerIndex++;
    });
</script>
</body>
</html>